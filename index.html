<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button id="haha">haha</button>
    <script>
        const deepLink = 'https://www.tesla.cn/_rs/referral?screen=referral_credits_screen';
        const deepLink2 = 'https://ownership.tesla.cn/_rs/referral?screen=referral_credits_screen';

        const sniffOS = () => {
            const uaStr = window.navigator.userAgent || window.navigator.vendor || window.opera || '';
            const isWeChat = /micromessenger/i.test(uaStr.toLowerCase());
            const isAndroid = /Android/i.test(uaStr);
            const isIOS = /iPad|iPhone|iPod/i.test(uaStr) && !window.MSStream;
            return {
                isWeChat,
                isAndroid,
                isIOS,
            };
        };
        const { isWeChat, isAndroid, isIOS } = sniffOS();
        const trigger = () => {
            if (isWeChat && isAndroid) {
                alert('请使用系统浏览器');
            } else if (isAndroid) {
                window.location.href = 'tesla://ownership.tesla.cn/_rs/referral?screen=referral_credits_screen'; // try to open TESLA app.
                setTimeout(() => {
                    window.location = 'https://www.tesla.cn/go/app'; // fallback: if haven't open app after 2s then auto download app.
                }, 2000);
            } else if (isIOS) {
//                   const ifr = document.createElement('iframe');
//                   ifr.src = deepLink;
//                   ifr.style.display = 'none';
//                   document.body.appendChild(ifr);
//                   setTimeout(() => {
//                     document.body.removeChild(ifr);
//                     window.location = 'https://apps.apple.com/cn/app/tesla/id582007913'; // fallback: if haven't open app after 2s then auto download app.
//                   }, 2000);
                
                window.location.href = Math.random() > 0.5 ? deepLink : deepLink2; // try to open TESLA app.
                setTimeout(() => {
                    window.location = 'https://apps.apple.com/cn/app/tesla/id582007913'; // fallback: if haven't open app after 2s then auto download app.
                }, 2000);
            }
        }
        document.getElementById('haha').addEventListener('click', trigger);
    </script>
</body>

</html>
